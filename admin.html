<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>K S Vegetables - Home</title>
  <link rel="stylesheet" href="style.css"/>
  <style>
    @keyframes blink {
    0%, 50%, 100% { opacity: 1; }
    25%, 75% { opacity: 0; }
}
  </style>
</head>
<body class="home-page">
  <header>
    <nav class="navbar">
      <!-- Left: Logo -->
      <div class="nav-left">
        <img src="LOGOks.png" alt="KS veg logo" class="navlogo">
      </div>

      <!-- Center: Title -->
      <div class="nav-center">
        <h1>  K S Vegetables</h1>
        <p>Admin Page</p>
      </div>
       
      <!-- Right: Links -->
      <div class="nav-right">
        <ul>
          <li><a href="admin.html">Home</a></li>
          <li> <a href="#" onclick="checkloginvieworder()" >Vieworder</a></li>
          <li><a id="loginNav" href="#" onclick="openLogin()">Login/Register</a></li>
          <li id="loginSuccessNav" style="display:none;">âœ…Loggedin| </li>
            <li id="profileMenu" class="profile-menu" style="display:none;">
              <img src="https://icons.veryicon.com/png/o/education-technology/learning-to-bully-the-king/user-name-15.png" alt="User" class="profile-icon" onclick="usericon()">

                <ul class="dropdown"  id="DD" style="display: none;">
                  
                   <li><a href="#" onclick="checkloginadmin()">My Profile</a></li>
                   <li><a href="#" onclick="checkloginvieworder()">ViewOrders</a></li>
                   
                  <li><a href="#" onclick="logout()">Logout</a></li>
                </ul>
            </li>
        </ul>
     </div>    
 </div>
       <div class="hamburger" onclick="toggleMenu()">
                <img src="https://icons.veryicon.com/png/o/education-technology/learning-to-bully-the-king/user-name-15.png" alt="User" class="profile-icon" onclick="usericon()">
            </div>
        <div class="profileiconmenu"  >
      <ul id="mobileDD">
     <li> <a href="#" onclick="checkloginprofile()">My Profile</a></li>
     <li><a href="#" onclick="checkloginorder()">ViewOrders</a></li>
     <li>
      <a href="#" id="loginham" onclick="openLogin()" style="display: none;">Login/Register</a>
      <a href="#" id="loginSuccessham" onclick="logout()" style="display: none;">Logout</a>
     </li>
     </ul>
    </div>
    </nav>
    
         <!-- Sticky Bottom Nav (only for mobile) -->
<nav class="mobile-nav">
  <a href="admin.html" class="nav-item">
    <i class="fas fa-home"></i>
    <span>Home</span>
  </a>
  <a href="#" onclick="checkloginvieworder()" class="nav-item">
    <i class="fas fa-shopping-cart"></i>
    <span>vieworder</span>
  </a>
  <a href="#" onclick="openLogin()" id="loginicon" class="nav-item" style="display: none;">
    <i class="fas fa-user"></i>
    <span>Login</span>
  </a>
  <a href="#" onclick="logout()" id="loginSuccessicon" class="nav-item" style="display: none;">
    <i class="fas fa-user"></i>
    <span>Logout</span>
  </a>

</nav>


<!-- FontAwesome for icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  </header>
  <script src="script.js"></script>


  <main class="home-main">
  <div class="home-content">
    <h2 class="center-text">Welcome  K S Mariappan</h2>
    <div id="newOrderAlert" style="
    display:none;
    position:fixed;
    top:10px;
    right:10px;
    background:red;
    color:white;
    padding:10px 20px;
    font-weight:bold;
    border-radius:5px;
    z-index:1000;
    animation: blink 1s infinite;">
    New Order Received!
    </div>
    <audio id="orderSound" src="mixkit-happy-bells-notification-937.wav" preload="auto"></audio>

    <div class="order-now">
      <a href="#" onclick="checkloginvieworder()" >View received orders </a>
    </div>
  </div>
</main>

  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

<script>
  const firebaseConfig = {
      apiKey: "AIzaSyAXOY6MTSvCosLY4oSxjLqpZ6qLUPhifGU",
      authDomain: "ksvegetables-3959d.firebaseapp.com",
      projectId: "ksvegetables-3959d",
      storageBucket: "ksvegetables-3959d.firebasestorage.app",
      messagingSenderId: "791132153293",
      appId: "1:791132153293:web:2fb8a42dd2262fd48b9084"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
let firstLoad = true; // prevent alert on initial fetch
let lastSeenOrderId = localStorage.getItem("lastSeenOrderId") || null;

db.collection("orders")
  .orderBy("timestamp", "desc")
  .limit(1)
  .onSnapshot((snapshot) => {
    if (snapshot.empty) return;

    const newOrder = snapshot.docs[0];
    const newOrderId = newOrder.id;

    // ðŸš€ First time: just remember the latest order, no alert
    if (!lastSeenOrderId) {
      lastSeenOrderId = newOrderId;
      localStorage.setItem("lastSeenOrderId", newOrderId);
      return;
    }

    // âœ… Only show alert if a *different* order arrives
    if (newOrderId !== lastSeenOrderId) {
      const alertDiv = document.getElementById("newOrderAlert");
      alertDiv.style.display = "block";

      // ðŸ”Š Play sound
      const sound = document.getElementById("orderSound");
      if (sound) {
        sound.currentTime = 0; 
        sound.play().catch(err => console.log("Autoplay blocked:", err));
      }

      setTimeout(() => {
        alertDiv.style.display = "none";
      }, 5000);

      // Save this order as last seen
      lastSeenOrderId = newOrderId;
      localStorage.setItem("lastSeenOrderId", newOrderId);
    }
  });
  function closePopup() {
     document.getElementById("loginPopup").style.display = "none";
}
function checkloginadmin() {
   const isLoggedIn = localStorage.getItem("isLoggedIn") === "true";
  if(isLoggedIn) {
    window.location.href = "adprofile.html";
  } else {
    alert("Please Login first!");
    openLogin();
  }
}
function checkloginvieworder() {
   const isLoggedIn = localStorage.getItem("isLoggedIn") === "true";
  if(isLoggedIn) {
    window.location.href="vieworders.html";
  }else {
    alert("Please Login First!");
    openLogin();
  }
}

function updateLoginStatus() {
  // hide login button
  document.getElementById("loginNav").style.display = "none";  

  // show success tick icon
  document.getElementById("loginSuccessNav").style.display = "block";  
}


// Call this function after successful login
function setLogin() {
  localStorage.setItem("isLoggedIn", "true");
  showLoginStatus();
}

// Call this function when logging out
function logout() {
  localStorage.removeItem("isLoggedIn");

  showLoginStatus();
  window.location.href="admin.html";
}

// Function to update nav UI
function showLoginStatus() {
  const isLoggedIn = localStorage.getItem("isLoggedIn") === "true";
  const loginNav = document.getElementById("loginNav");
  const loginSuccessNav = document.getElementById("loginSuccessNav");
  const loginSuccessicon = document.getElementById("loginSuccessicon");
  const loginicon = document.getElementById("loginicon");
  const loginham = document.getElementById("loginham");
  const loginSuccessham = document.getElementById("loginSuccessham");

  if (isLoggedIn) {
    loginNav.style.display = "none";
    loginSuccessNav.style.display = "inline-block";
    loginSuccessicon.style.display="flex";
    loginSuccessham.style.display="block";
  } else {
    loginNav.style.display = "inline-block";
    loginSuccessNav.style.display = "none";
    loginicon.style.display="flex";
    loginham.style.display="block";
  }
}
 function usericon() {
  let dropdown = document.getElementById("DD");
  if (dropdown.style.display === "block") {
    dropdown.style.display = "none";  // close if already open
  } else {
    dropdown.style.display = "block"; // open if closed
  }
}
function checkloginprofile() {
  const isLoggedIn = localStorage.getItem("isLoggedIn") === "true";
  if(isLoggedIn) {
    window.location.href="adprofile.html";
  } else {
    alert("Please login first!");
    openLogin();
  }
}
function checkloginorder() {
  const isLoggedIn = localStorage.getItem("isLoggedIn") === "true";
  if(isLoggedIn) {
    window.location.href="vieworders.html";
  } else {
    alert("Please login first!");
    openLogin();
  } 
}
// Run on every page load
document.addEventListener("DOMContentLoaded", showLoginStatus);

document.addEventListener("DOMContentLoaded", function () {
  let currentPage = window.location.pathname.split("/").pop(); // e.g., "order.html"
  let navLinks = document.querySelectorAll(".mobile-nav .nav-item");

  navLinks.forEach(link => {
    let href = link.getAttribute("href");
    if (href && href === currentPage) {
      link.classList.add("active");
    }
  });
});
// Close dropdown when clicking outside
document.addEventListener("click", function (event) {
  const dropdown = document.getElementById("DD");
  const profileIcon = document.querySelector(".profile-icon"); // your profile image

  if (
    dropdown.style.display === "block" && 
    !dropdown.contains(event.target) && 
    !profileIcon.contains(event.target)
  ) {
    dropdown.style.display = "none";
  }
});

// Close dropdown when clicking outside
document.addEventListener("click", function (event) {
  const dropdown = document.getElementById("mobileDD");
  const profileIcon = document.querySelector(".profile-icon"); // your profile image

  if (
    dropdown.style.display === "block" && 
    !dropdown.contains(event.target) && 
    !profileIcon.contains(event.target)
  ) {
    dropdown.style.display = "none";
  }
});
document.addEventListener("DOMContentLoaded", () => {
  const role = localStorage.getItem("userRole");
  if (role !== "admin") {
    window.location.href = "index.html"; // kick non-admins back
  }
});




</script>
<!-- Login Popup -->
<div id="loginPopup" class="popup">
    <div class="popup-content">
         <span class="close-btn" onclick="closeLogin()">&times;</span>
      <iframe id="loginFrame" src="" width="100%" height="400px" style="border:none;"></iframe>
    </div>
  </div>

  
  <footer>
    <p>&copy; 2025 KS Veg. All rights reserved.</p>
  </footer>
  
  
  
</body>
</html>
